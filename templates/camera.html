{% extends 'base.html' %} {% import "bootstrap/wtf.html" as wtf %} {% block
title %}Camera{% endblock title %} {% block body %}

<!-- Stylized Camera Feed -->
<video
  id="cameraFeed"
  autoplay
  style="
    display: block;
    width: 100%;
    max-width: 640px;
    border: 5px solid #333;
    border-radius: 15px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    margin: 30px auto;
  "
></video>

<!-- Stylized Capture Button -->
<button
  id="captureButton"
  style="
    display: block;
    width: 200px;
    height: 50px;
    margin: 10px auto;
    background-color: #007bff;
    color: white;
    font-size: 1.5rem;
    border: none;
    border-radius: 25px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    cursor: pointer;
  "
>
  Capture
</button>

<!-- Stylized Result Div -->
<div
  id="result"
  style="
    max-width: 640px;
    margin: 20px auto;
    padding: 20px;
    background-color: #fafafa;
    border: 2px solid #ccc;
    border-radius: 15px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  "
></div>

<script>
  const video = document.getElementById("cameraFeed");
  const captureButton = document.getElementById("captureButton");
  const resultDiv = document.getElementById("result");

  async function startCamera() {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
  }

  captureButton.addEventListener("click", async () => {
    const canvas = document.createElement("canvas");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const imageData = canvas.toDataURL("image/jpeg"); // Convert to image data

    // Send imageData to backend
    const response = await fetch("/process_image", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ image: imageData }),
    });

    const data = await response.json();
    resultDiv.textContent = data.text; // Display sample text
  });

  startCamera();
</script>

{% endblock body %}
